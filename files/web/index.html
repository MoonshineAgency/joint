<!doctype html>
<html>
<head>
	<meta charset="utf8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>esp-iot-node</title>
	<link rel="stylesheet" href="styles.css">
	<script type="text/javascript" src="jquery.js"></script>
</head>
<body>
	<!-- -------------------------------------------------------------------------- -->
	<svg aria-hidden="true" style="position: absolute; width: 0; height: 0; overflow: hidden;" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
		<defs>
			<symbol id="icon-wifi" viewBox="0 0 40 32">
				<path d="M20 18c3.308 0 6.308 1.346 8.481 3.519l-2.827 2.827c-1.449-1.449-3.449-2.346-5.654-2.346s-4.206 0.897-5.654 2.346l-2.827-2.827c2.173-2.173 5.173-3.519 8.481-3.519zM5.858 15.858c3.777-3.777 8.8-5.858 14.142-5.858s10.365 2.080 14.142 5.858l-2.828 2.828c-3.022-3.022-7.040-4.686-11.314-4.686s-8.292 1.664-11.314 4.686l-2.828-2.828zM30.899 4.201c3.334 1.41 6.329 3.429 8.899 6v0l-2.828 2.828c-4.533-4.533-10.56-7.029-16.971-7.029s-12.438 2.496-16.971 7.029l-2.828-2.828c2.571-2.571 5.565-4.589 8.899-6 3.453-1.461 7.12-2.201 10.899-2.201s7.446 0.741 10.899 2.201zM18 28c0-1.105 0.895-2 2-2s2 0.895 2 2c0 1.105-0.895 2-2 2s-2-0.895-2-2z"></path>
			</symbol>
			<symbol id="icon-reboot" viewBox="0 0 32 32">
				<path d="M32 12h-12l4.485-4.485c-2.267-2.266-5.28-3.515-8.485-3.515s-6.219 1.248-8.485 3.515c-2.266 2.267-3.515 5.28-3.515 8.485s1.248 6.219 3.515 8.485c2.267 2.266 5.28 3.515 8.485 3.515s6.219-1.248 8.485-3.515c0.189-0.189 0.371-0.384 0.546-0.583l3.010 2.634c-2.933 3.349-7.239 5.464-12.041 5.464-8.837 0-16-7.163-16-16s7.163-16 16-16c4.418 0 8.418 1.791 11.313 4.687l4.687-4.687v12z"></path>
			</symbol>
			<symbol id="icon-main" viewBox="0 0 32 32">
				<path d="M14 4v-0.5c0-0.825-0.675-1.5-1.5-1.5h-5c-0.825 0-1.5 0.675-1.5 1.5v0.5h-6v4h6v0.5c0 0.825 0.675 1.5 1.5 1.5h5c0.825 0 1.5-0.675 1.5-1.5v-0.5h18v-4h-18zM8 8v-4h4v4h-4zM26 13.5c0-0.825-0.675-1.5-1.5-1.5h-5c-0.825 0-1.5 0.675-1.5 1.5v0.5h-18v4h18v0.5c0 0.825 0.675 1.5 1.5 1.5h5c0.825 0 1.5-0.675 1.5-1.5v-0.5h6v-4h-6v-0.5zM20 18v-4h4v4h-4zM14 23.5c0-0.825-0.675-1.5-1.5-1.5h-5c-0.825 0-1.5 0.675-1.5 1.5v0.5h-6v4h6v0.5c0 0.825 0.675 1.5 1.5 1.5h5c0.825 0 1.5-0.675 1.5-1.5v-0.5h18v-4h-18v-0.5zM8 28v-4h4v4h-4z"></path>
			</symbol>
			<symbol id="icon-switch" viewBox="0 0 32 32">
				<path d="M20 4.581v4.249c1.131 0.494 2.172 1.2 3.071 2.099 1.889 1.889 2.929 4.4 2.929 7.071s-1.040 5.182-2.929 7.071c-1.889 1.889-4.4 2.929-7.071 2.929s-5.182-1.040-7.071-2.929c-1.889-1.889-2.929-4.4-2.929-7.071s1.040-5.182 2.929-7.071c0.899-0.899 1.94-1.606 3.071-2.099v-4.249c-5.783 1.721-10 7.077-10 13.419 0 7.732 6.268 14 14 14s14-6.268 14-14c0-6.342-4.217-11.698-10-13.419zM14 0h4v16h-4z"></path>
			</symbol>
			<symbol id="icon-menu" viewBox="0 0 32 32">
				<path d="M2 6h28v6h-28zM2 14h28v6h-28zM2 22h28v6h-28z"></path>
			</symbol>
			<symbol id="icon-reset" viewBox="0 0 32 32">
				<path d="M16 2.899l13.409 26.726h-26.819l13.409-26.726zM16 0c-0.69 0-1.379 0.465-1.903 1.395l-13.659 27.222c-1.046 1.86-0.156 3.383 1.978 3.383h27.166c2.134 0 3.025-1.522 1.978-3.383h0l-13.659-27.222c-0.523-0.93-1.213-1.395-1.903-1.395v0z"></path>
				<path d="M18 26c0 1.105-0.895 2-2 2s-2-0.895-2-2c0-1.105 0.895-2 2-2s2 0.895 2 2z"></path>
				<path d="M16 22c-1.105 0-2-0.895-2-2v-6c0-1.105 0.895-2 2-2s2 0.895 2 2v6c0 1.105-0.895 2-2 2z"></path>
			</symbol>
		</defs>
	</svg>
	<!-- -------------------------------------------------------------------------- -->
	<div id="container" style="display: none;">
		<!-- Wifi form -->
		<div class="form" id="f_wifi">
			<div id="f_wifi_message" class="message"></div>
			<fieldset>
				<legend>Common settings</legend>
				<div class="ui-widget">
					<label for="i_wifi_ip_dhcp">Enable DHCP</label>
					<div><input type="checkbox" id="i_wifi_ip_dhcp" style="min-width: auto;"></div>
				</div>
				<div class="ui-widget">
					<label for="i_wifi_ip_ip">IP address:</label>
					<input type="text" id="i_wifi_ip_ip" />
				</div>
				<div class="ui-widget">
					<label for="i_wifi_ip_netmask">Netmask:</label>
					<input type="text" id="i_wifi_ip_netmask" />
				</div>
				<div class="ui-widget">
					<label for="i_wifi_ip_gateway">Gateway:</label>
					<input type="text" id="i_wifi_ip_gateway" />
				</div>
				<div class="ui-widget">
					<label for="i_wifi_ip_dns">DNS:</label>
					<input type="text" id="i_wifi_ip_dns" />
				</div>
			</fieldset>
			<fieldset id="wifi_ap">
				<legend>Access Point settings</legend>
				<div class="ui-widget">
					<label for="i_wifi_ap_ssid">SSID:</label>
					<input type="text" id="i_wifi_ap_ssid" />
				</div>
				<div class="ui-widget">
					<label for="i_wifi_ap_channel">Channel:</label>
					<input type="number" id="i_wifi_ap_channel" />
				</div>
				<div class="ui-widget">
					<label for="i_wifi_ap_password">Password:</label>
					<input type="text" id="i_wifi_ap_password" />
				</div>
			</fieldset>
			<fieldset id="wifi_station">
				<legend>Station settings</legend>
				<div class="ui-widget">
					<label for="i_wifi_sta_ssid">SSID:</label>
					<input type="text" id="i_wifi_sta_ssid" />
				</div>
				<div class="ui-widget">
					<label for="i_wifi_sta_password">Password:</label>
					<input type="text" id="i_wifi_sta_password" />
				</div>
			</fieldset>
			<div class="buttons">
				<button id="b_wifi_save" class="ui-button">Save settings</button>
				<button id="b_wifi_cancel" class="ui-button cancel">Cancel</button>
			</div>
		</div>

		<!-- message -->
		<div id="f_message" class="message"></div>
	</div>
	<!-- -------------------------------------------------------------------------- -->
	<div id="page">
		<div class="header">
			<div class="left">
				<div class="header-left">
					<span id="app_name">esp-iot-node</span>
					<span class="small">
						version: <span id="app_version">1.013423</span>,
						built at <span id="build_date">01 May 2021</span>
					</span>
				</div>
			</div>
			<a id="btn_menu" class="icon" style="cursor: pointer"><svg class="icon icon-menu"><use xlink:href="#icon-menu"></use></svg></a>
		</div>
		<div id="menu">
			<a id="mi_main" href="#"><svg class="icon icon-main"><use xlink:href="#icon-main"></use></svg> Main page</a>
			<a id="mi_wifi" href="#"><svg class="icon icon-wifi"><use xlink:href="#icon-wifi"></use></svg> WiFi settings</a>
			<a id="mi_mqtt" href="#"><svg class="icon icon-mqtt"><use xlink:href="#icon-mqtt"></use></svg> MQTT settings</a>
			<a id="mi_system" href="#"><svg class="icon icon-system"><use xlink:href="#icon-system"></use></svg> System settings</a>
			<a id="mi_reset" href="#"><svg class="icon icon-reset"><use xlink:href="#icon-reset"></use></svg> Reset system settings</a>
			<a id="mi_reboot" href="#"><svg class="icon icon-reboot"><use xlink:href="#icon-reboot"></use></svg> Reboot</a>
		</div>
		<div id="content">
	</div>
	<!-- -------------------------------------------------------------------------- -->
	<script>
	$(document).ready(function() {
		let $content = $('#content');
		let $container = $('#container');
		let $menu = $('#menu');
		
		let $mi_main = $('#mi_main');
		
		let $main_page = $('#f_main');
		
		let $wifi_form = $('#f_wifi'); 
		let $wifi_msg = $('#f_wifi_message');
		let $mqtt_form = $('#f_mqtt');
		let $mqtt_msg = $('#f_mqtt_message');
		let $sys_form = $('#f_sys');
		let $sys_msg = $('#f_sys_message');
		let $f_msg = $('#f_message');
		
		let $effect = $('#effect');
		let $effect_params = $('#effect_params');
		let $brightness = $('#brightness');
		let $brightness_val = $('#brightness-val');
		let $fps = $('#fps');
		let $fps_val = $('#fps-val');
		let $param_range = $('#param_range');
		let $param_bool = $('#param_bool');

		// load info
		$.getJSON('/api/info', function(info) {
			$('#app_name').html(info.app_name);
			$('#app_version').html(info.app_version);
			$('#build_date').html(info.build_date);
		});
		
		function refresh_main() {

		}

		// post wifi
		$('#b_wifi_save').click(function() {
			let data = {
				ip: {
					dhcp: $('#i_wifi_ip_dhcp').prop('checked'),
					ip: $('#i_wifi_ip_ip').val(),
					netmask: $('#i_wifi_ip_netmask').val(),
					gateway: $('#i_wifi_ip_gateway').val(),
					dns: $('#i_wifi_ip_dns').val()
				},
				ap: {
					ssid: $('#i_wifi_ap_ssid').val(),
					channel: parseInt($('#i_wifi_ap_channel').val()),
					password: $('#i_wifi_ap_password').val(),
				},
				sta: {
					ssid: $('#i_wifi_sta_ssid').val(),
					password: $('#i_wifi_sta_password').val(),
				}
			};
			console.log(data);
			$.ajax({
				type: 'POST',
				url: '/api/settings/wifi',
				data: JSON.stringify(data),
				success: function(res) {
					console.log(res);
					$wifi_msg.prop('class', res.result !=0 ? 'msg_err' : 'msg_ok')
						.html('<b>' + res.name + '</b>: ' + res.message);
					$wifi_msg.show();
				},
				error: function(err) {
					console.log(err);
					alert(err.status + ' ' + err.statusText);
				}
			});
		});
		
		// Menu
		$('#btn_menu').click(function() {
			$menu.toggleClass('visible');
		});
		$menu.children().click(function() {
			$menu.removeClass('visible');
		});

		// show wifi form
		$('#mi_wifi').click(function() {
			$content.children().detach().appendTo($container);
			$wifi_form.detach().appendTo($content);
			$wifi_msg.hide();
			$.getJSON('/api/settings/wifi', function(data) {
				console.log(data);
				$('#i_wifi_ip_dhcp').prop('checked', data.ip.dhcp);
				$('#i_wifi_ip_ip').val(data.ip.ip);
				$('#i_wifi_ip_netmask').val(data.ip.netmask);
				$('#i_wifi_ip_gateway').val(data.ip.gateway);
				$('#i_wifi_ip_dns').val(data.ip.dns);
				$('#i_wifi_ap_ssid').val(data.ap.ssid);
				$('#i_wifi_ap_channel').val(data.ap.channel);
				$('#i_wifi_ap_password').val(data.ap.password);
				$('#i_wifi_sta_ssid').val(data.sta.ssid);
				$('#i_wifi_sta_password').val(data.sta.password);
			});
		});
		
		// reboot
		$('#mi_reboot').click(function() {
			if (!confirm('Are you sure you want to reboot?'))
				return;
			$.getJSON('/api/reboot', function(res) {});
			setTimeout(window.location.reload.bind(window.location), 3000);
		});
		
		// reset settings
		$('#mi_reset').click(function() {
			$content.children().detach().appendTo($container);
			$f_msg.detach().appendTo($content);
			$f_msg.hide();
			if (!confirm('Are you sure you want to reset settings to defaults?'))
			{
				$mi_main.click();
				return;
			}
			$.getJSON('/api/settings/reset', function(res) {
				console.log(res);
				$f_msg.prop('class', res.result !=0 ? 'msg_err' : 'msg_ok')
					.html('<b>' + res.name + '</b>: ' + res.message);
				$f_msg.show();
			});
		});

		// show main page
		$('#mi_main, .cancel').click(function() {
			$content.children().detach().appendTo($container);
			$main_page.detach().appendTo($content);
			refresh_main();
		});
		$mi_main.click();
	});
	</script>
</body>
</html>
